{"version":3,"sources":["/Users/yangqianjun/Documents/project/sm2tsservice/update.md"],"names":["layoutProps","MDXLayout","MDXContent","components","props","mdxType","parentName","color","isMDXComponent"],"mappings":"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","file":"static/js/update.74d25931.js","sourcesContent":["\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\n\n/* @jsx mdx */\n\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h1 {...{\n      \"id\": \"风险处置指南\"\n    }}>{`风险处置指南`}</h1>\n    <h2 {...{\n      \"id\": \"技术方案介绍\"\n    }}>{`技术方案介绍`}</h2>\n    <h3 {...{\n      \"id\": \"关键词\"\n    }}>{`关键词`}</h3>\n    <h4 {...{\n      \"id\": \"tags\"\n    }}>{`tags`}</h4>\n    <p>{`生成与 tags 一一对应的 service 文件，比如 `}<inlineCode parentName=\"p\">{`\"User\" => \"UserApi.ts\"`}</inlineCode>{` - 所以 tags 一旦设定不许更改`}</p>\n    <p>{`工具不能处理中文 - 所以要求 tags 必须为英文，所以 yapi 需要中英文映射`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`  \"yapiConfig\": {\n    \"categoryMap\": {\n      \"中文\": \"English\"\n    }\n  }\n`}</code></pre>\n    <h4 {...{\n      \"id\": \"operationid\"\n    }}>{`operationId`}</h4>\n    <p>{`每个接口全局唯一的操作 id，通过 `}<inlineCode parentName=\"p\">{`controller method name + Using + http method name`}</inlineCode>{`，出现重名会自增一 - 但顺序不可控，工具通过 operationId 生成接口调用代码，因此存在逻辑错乱的风险，协作方无法预测并告知变动`}</p>\n    <h4 {...{\n      \"id\": \"safe\"\n    }}>{`safe`}</h4>\n    <p>{`基于 `}<inlineCode parentName=\"p\">{`url + Using + http method`}</inlineCode>{` 生成 `}<inlineCode parentName=\"p\">{`operationId`}</inlineCode>{` - 唯一且可控，以上因素的变动，协作方有通知义务`}</p>\n    <h4 {...{\n      \"id\": \"strict\"\n    }}>{`strict`}</h4>\n    <p>{`在 `}<inlineCode parentName=\"p\">{`safe`}</inlineCode>{` 的基础上，添加对 `}<inlineCode parentName=\"p\">{`tags`}</inlineCode>{` `}<inlineCode parentName=\"p\">{`definitions`}</inlineCode>{` 命名规范校验`}</p>\n    <h4 {...{\n      \"id\": \"dto\"\n    }}>{`DTO`}</h4>\n    <p>{`swagger 定义的数据结构，对应生成 typescript interface - 工具无法处理中文，因此 DTO 名字必须是英文`}</p>\n    <h4 {...{\n      \"id\": \"params\"\n    }}>{`params`}</h4>\n    <p>{`参数、变量名必须是小驼峰格式 - 及符合前端代码规范、合法的变量名、属性名`}</p>\n    <h3 {...{\n      \"id\": \"接口文档\"\n    }}>{`接口文档`}</h3>\n    <h4 {...{\n      \"id\": \"swagger\"\n    }}>{`swagger`}</h4>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`  // 控制器\n  @Api(tags=\"English\", description=\"中文描述\") // tags 用以生成 service 分组，默认值为 any-controller 类名\n  class AnyController {\n    @ApiOperation(value=\"概述\", notes=\"详细描述\")\n    @ApiParam(name = \"gender\", value = \"性别\", required = true) // name 必须使用小驼峰\n    public doSomething() {} // 生成 operationId，比如 doSomethingUsingGet_1, doSomethingUsingGet_2\n  }\n\n  // DTO\n  @Data\n  @ApiModel(value=\"English\", description=\"用户基本信息\") // 必须手写 value，使用[a-zA-Z0-9]\n  public class UserVO {}\n`}</code></pre>\n    <h4 {...{\n      \"id\": \"mock\"\n    }}>{`mock`}</h4>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`  接口分类 => tags\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"处置指南\"\n    }}>{`处置指南`}</h2>\n    <h3 {...{\n      \"id\": \"升级工具\"\n    }}>{`升级工具`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`npm i -D @tkit/service // 公司内 3.0.7+\nnpm i -D sm2tsservice  // 公司外部 1.1.8+\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"处置方式\"\n    }}>{`处置方式`}</h3>\n    <h4 {...{\n      \"id\": \"公共逻辑\"\n    }}>{`公共逻辑`}</h4>\n    <h5 {...{\n      \"id\": \"参数格式校验\"\n    }}>{`参数格式校验`}</h5>\n    <p>{`工具要求新老项目参数必须是小驼峰英文格式，否则报错，生成失败`}</p>\n    <h4 {...{\n      \"id\": \"特殊逻辑\"\n    }}>{`特殊逻辑`}</h4>\n    <p>{`通过 `}<inlineCode parentName=\"p\">{`mode`}</inlineCode>{` 控制工具的行为`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`{\n  \"guardConfig\": {\n    \"mode\": \"strict\" | \"safe\" | undefined\n  }\n}\n`}</code></pre>\n    <h5 {...{\n      \"id\": \"维持现状\"\n    }}>{`维持现状`}</h5>\n    <p>{`老项目，不配置 `}<inlineCode parentName=\"p\">{`mode`}</inlineCode>{`，重新生成 service 代码，如果检测到风险 operationId，则抛出错误生成失败，输出映射关系，请手动将提示添加到配置文件内，并提交到仓库，如：`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`  \"guardConfig\": {\n    \"methodUrl2OperationIdMap\": {\n      {\n        \"get /api/xxx/xxx\": \"operationId\",\n        ...\n      }\n    }\n  }\n`}</code></pre>\n    <p>{`后续有任何变动的时候，工具会根据本地已有映射关系对 swagger 返回 `}<inlineCode parentName=\"p\">{`operationId`}</inlineCode>{` 进行校正，并对增删改做出检测提示，确保业务逻辑不受影响`}</p>\n    <font color=\"red\">警告</font>\n    <blockquote>\n      <ul parentName=\"blockquote\">\n        <li parentName=\"ul\">{`@tkit/service@3.0.7 sm2tservice@1.1.8 本身及以下，仅能确保初次给出的映射建议正确`}</li>\n        <li parentName=\"ul\">{`后续给出增量映射关系，务必人工确保新增映射 `}<inlineCode parentName=\"li\">{`operationId`}</inlineCode>{` 不与老映射 `}<inlineCode parentName=\"li\">{`operationId`}</inlineCode>{` 重复，校正为任一不重复有语义值即可，建议 `}<inlineCode parentName=\"li\">{`url + Using + http method`}</inlineCode>{` - 否则可能会报 java `}<inlineCode parentName=\"li\">{`overload`}</inlineCode>{` 错误，且后续无法升级到 `}<inlineCode parentName=\"li\">{`safe`}</inlineCode>{` 模式`}</li>\n        <li parentName=\"ul\">{`或请升级到 @tkit/service@3.0.8+ sm2tservice@1.1.9+`}</li>\n      </ul>\n    </blockquote>\n    <h5 {...{\n      \"id\": \"安全模式\"\n    }}>{`安全模式`}</h5>\n    <p>{`老项目，也可以配置 `}<inlineCode parentName=\"p\">{`mode`}</inlineCode>{` 为 `}<inlineCode parentName=\"p\">{`\"safe\"`}</inlineCode>{`，则工具会基于 `}<inlineCode parentName=\"p\">{`url + Using + http method`}</inlineCode>{` 生成新的 `}<inlineCode parentName=\"p\">{`operationId`}</inlineCode>{` 以生成更安全和语义化的接口调用代码，但需满足`}</p>\n    <ul>\n      <li parentName=\"ul\">{`已保存 `}<inlineCode parentName=\"li\">{`methodUrl2OperationIdMap`}</inlineCode>{` 映射关系锁定`}</li>\n      <li parentName=\"ul\">{`人工更新 service 调用`}</li>\n    </ul>\n    <p>{`工具会自动生成 `}<inlineCode parentName=\"p\">{`旧接口调用`}</inlineCode>{` => `}<inlineCode parentName=\"p\">{`新接口调用`}</inlineCode>{` 映射关系，请自上而下依次全局替换即可，如：`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`{\n  \"getUserNameUsingGet_2\": \"getUserNameUsingGet\",\n  \"getUserNameUsingGet_1\": \"getNameUsingGet\",\n}\n`}</code></pre>\n    <h5 {...{\n      \"id\": \"严格模式\"\n    }}>{`严格模式`}</h5>\n    <p>{`新项目，一律配置 `}<inlineCode parentName=\"p\">{`mode`}</inlineCode>{` 为 `}<inlineCode parentName=\"p\">{`\"strict\"`}</inlineCode>{`，采用 `}<inlineCode parentName=\"p\">{`\"safe\"`}</inlineCode>{` 相同的 `}<inlineCode parentName=\"p\">{`operationId`}</inlineCode>{` 生成策略`}</p>\n    <ul>\n      <li parentName=\"ul\">{`要求 swagger 文档 `}<inlineCode parentName=\"li\">{`tags`}</inlineCode>{` `}<inlineCode parentName=\"li\">{`definitions`}</inlineCode>{` `}<inlineCode parentName=\"li\">{`params`}</inlineCode>{` 符合命名规范`}</li>\n      <li parentName=\"ul\">{`【暂时】仍要求先保存 `}<inlineCode parentName=\"li\">{`methodUrl2OperationIdMap`}</inlineCode>{` 映射关系锁定，再重新生成`}</li>\n      <li parentName=\"ul\">{`可直接忽略旧、新接口调用映射关系提示`}</li>\n    </ul>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"],"sourceRoot":""}